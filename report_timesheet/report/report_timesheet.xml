<odoo>
    <data>
        
        <record model="ir.ui.view" id="report_timesheet_group_by_task">
            <field name="name">BP Rapport Feuille de temps</field>
            <field name="inherit_id" ref="hr_timesheet.timesheet_table"/>
            <field name="arch" type="xml">

                <!-- Suppression colonne inutiles -->
                <xpath expr="/t/div/div/table/thead/tr/th[4]" position="replace"/>
                <xpath expr="/t/div/div/table/thead/tr/th[4]" position="replace"/>
                <xpath expr="/t/div/div/table/thead/tr/th[1]" position="replace"/>

                <xpath expr="/t/t" position="replace">
                    <t t-set="is_uom_day" t-value="is_uom_day"/>
                </xpath>
                
                <xpath expr="/t/div/div/table/tbody" position="replace">
                    <tbody>
 
                        <t t-set="nbCols" t-value="2"/>
                        <t t-if="show_project" t-set="nbCols" t-value="nbCols + 1"/>

                        <t t-set="is_first_line" t-value="True" />
                        
                        <tr t-foreach="lines" t-as="line">
                            
                            <t t-if="line['display_type'] == 'task'">
                                <t t-if="is_first_line == False ">
                                    <tr> <!-- Affichage d'une ligne blanche entre deux tâches -->
                                        <td t-attf-colspan="{{nbCols}}" style="border-top: 1px solid #dee2e6; border-bottom: 1px solid black; height: 20px; background-color: white;"/>
                                    </tr>
                                </t>
                                <t t-set="is_first_line" t-value="False"/>
                                <tr>
                                    <td id="task_name" t-attf-colspan="nbCols-1" class="task_row" style="font-weight: bold; border-right: none;">
                                        <span t-if="line['data']['task']" t-esc="line['data']['task']"/> 
                                        <span t-else="">Tâche Non Renseignée</span>
                                    </td>
                                    <td id="total_task" class="task_row text-end" style="border-left: none;">
                                            Total: <span t-esc="line['data']['worktime']"  t-options="{'widget':'float_time'}"/>
                                    </td> 
                                </tr>
                            </t>
                            
                            <t t-if="line['display_type'] == 'worktype'">
                                <tr>
                                    <td name="description_name" t-attf-colspan="nbCols-1" class="worksite_row" style="font-weight: 600; border-right: none; padding-left:20px;">
                                        <span t-if="line['data']['worktype'] != '' " t-esc="line['data']['worktype']"/>
                                        <span t-else="">Type de Travail Non Renseigné</span>
                                    </td>
                                    <td id="total_description" class="worksite_row text-end" style="border-left:none;"> 
                                            Sous-Total : <span t-esc="line['data']['worktime']" t-options="{'widget':'float_time'}"/>
                                    </td> 
                                </tr>
                            </t>
                            
                            <t t-if="line['display_type'] == 'line'">
                                <td class="align-middle" style="border-right: 1px solid #dee2e6; padding-left:40px;">
                                   <span t-esc="line['data']['employee']"/>
                                </td>
                                <td t-if="show_project" class="align-middle" style="border-right: 1px solid #dee2e6;">
                                    <span t-esc="line['data']['project_id']"/>
                                </td>
                               
                                <td class="text-end align-middle" id="line_time" style="border-left: 1px solid #dee2e6;">
                                    <!-- t-else=""<span t-if="is_uom_day" t-esc="line._get_timesheet_time_day()" t-options="{'widget': 'timesheet_uom'}"/> -->
                                    <span t-esc="line['data']['worktime']" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/>
                                </td>
                            </t>
                        </tr>

                        <!-- Total horaire -->
                        <tr>
                            <td class="text-end" t-attf-colspan="{{nbCols}}" style="background-color:rgba(0, 0, 0, 0.9); color:#fff;">
                                <strong t-if="is_uom_day">
                                    <span style="margin-right: 15px;">Total (Jours)</span>
                                    <t t-esc="lines._convert_hours_to_days(sum([line['data']['worktime'] for line in lines if line['display_type'] == 'task']))" t-options="{'widget': 'timesheet_uom'}"/>
                                </strong>
                                <strong t-else="">
                                    <span style="margin-right: 15px;">Total (Heures)</span>
                                    <t t-esc="sum([line['data']['worktime'] for line in lines if line['display_type'] == 'task'])" t-options="{'widget': 'duration', 'digital': True, 'unit': 'hour', 'round': 'minute'}"/>
                                </strong>
                            </td>
                        </tr>                        
                    </tbody>
                    
                </xpath>
                
            </field>
        </record>

        <record model="ir.ui.view" id="report_timesheet_call">
            <field name="name">BP - Rapport Feuille de temps</field>
            <field name="inherit_id" ref="hr_timesheet.report_timesheet"/>
            <field name="arch" type="xml">

                <xpath expr="/t/t/t/div/t" position="replace">
                    <t t-set="lines" t-value="lines_ordered"/>
                </xpath>
                
            </field>
        </record>

        <record model="ir.ui.view" id="report_timesheet_task_call">
            <field name="name">BP - Rapport Feuille de temps</field>
            <field name="inherit_id" ref="hr_timesheet.timesheet_project_task_page"/>
            <field name="arch" type="xml">

                <xpath expr="/t/t[4]/t/div/t/div[2]/div/t/t" position="replace">
                    <t t-set="lines" t-value="_get_timesheet_line(doc.id)"/>
                </xpath>

                <xpath expr="/t/t[4]/t/div/t/div[2]/div/t/h2/span" position="replace">
                    <span>Feuille de temps
                        <t t-if="show_record">
                             : <t t-out="doc.name"/>
                        </t>
                    </span>
                </xpath>

                <xpath expr="/t/t[4]/t/div/t" position="before">
                    <head>
                         <style>
                            .task_row {background-color: #B37A51 !important; color:black !important; border-bottom: 1px solid black; border-top: 1px solid black !important}
                            .worksite_row {background-color: #DFC6B3 !important; color:black !important; border-bottom: 1px solid black; border-top: 1px solid black !important}
                                                        
                            #line_time {background-color:white !important}
                            
                            td {border-color: #dee2e6}
                        </style>
                    </head>
                </xpath>
                
            </field>
        </record>
        
    </data>
</odoo>